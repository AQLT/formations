{
  "hash": "618318dec93f1e788a4e1f1b1c49be02",
  "result": {
    "markdown": "---\ntitle: \"2 - Analyse graphique\"\nsubtitle: |\n  Analyse des séries temporelles avec R\nauthor: \"Alain Quartier-la-Tente\"\nformat: html\nlang: fr\nlanguage: \n title-block-author-single: Auteur\n---\n\n\n\n\n> L'objectif de ce TP est d'approfondir les analyses graphiques et les transformations pour stabiliser la variance.\n\nLes packages suivants seront utilisés :\n\n\n::: {.cell hash='2_Graphiques_cache/html/unnamed-chunk-1_45533585ab926f5b6332cc63d58d772a'}\n\n```{.r .cell-code}\npackages_to_install <- c(\"forecast\", \"ggplot2\", \"patchwork\", \"lubridate\", \"USgas\", \"tsibble\", \"fpp2\", \"fpp3\")\npackages <- installed.packages()[,\"Package\"][! packages_to_install %in% installed.packages()[,\"Package\"]]\nif (length(packages) > 0) {\n\tinstall.packages(packages)\n}\n```\n:::\n\n::: {.cell hash='2_Graphiques_cache/html/unnamed-chunk-2_94a53620d93ab4cff445ee43a5d9054e'}\n\n```{.r .cell-code}\nlibrary(forecast)\nlibrary(ggplot2)\nlibrary(patchwork)\nlibrary(lubridate)\nlibrary(USgas)\nlibrary(tsibble)\nlibrary(fpp2)\nlibrary(fpp3)\n```\n:::\n\n\n# Manipulation graphique\n\n## Analyse graphique temporelle\n\nLe but des prochains exercices est de mettre en pratique les différentes fonctions pour tracer les graphiques vues en cours.\n\n::: callout-note\n## Exercice\nEn utilisant la fonction `help()`, décrire les trois séries temporelles `gold`, `woolyrnq` et `gas` du package `forecast`.\nQuelles sont les périodicités des séries ?\n\nTracer les 3 séries.\nRepérer le point atypique sur la série `gold` : à quelle observation apparaît-il ?\nÀ quelle date cela correspond ?\n:::\n\n::: {.callout-caution collapse=\"true\"}\n## Indice\nOn pourra utiliser la fonction `which.max()` pour repérer le point atypique.\nLa série `gold` correspond à la série journalière des prix de l'or hors vendredi samedi : pour récupérer les jours correspondants aux numéros des observations, on pourra utiliser la fonction `seq.Date()` ainsi que la fonction `lubridate::wday()`.\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n`gold` représente les prix journaliers de l'or en dollar (hors vendredi et samedi) entre le 1er janvier 1985 et le 31 Mars 1989. \nIl semble y avoir des valeurs manquantes, un point atypique autour de l'observation 750. \nUne tendance plutôt à la hausse jusqu'à cette observation puis une tendance à la baisse. \nPas de saisonnalité visible\n\n\n::: {.cell hash='2_Graphiques_cache/html/gold_fa558f37d6aeb2ba6b7a43dd0175126b'}\n\n```{.r .cell-code}\nautoplot(gold, y = \"Prix en $\",\n\t\t main = \"Prix journaliers de l'or\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/gold-1.png){width=672}\n:::\n:::\n\n\n`woolyrnq` représente la production trimestrielle de laine en Australie (en tonnes) entre le premier trimestre 1965 et le troisième trimestre 1994. \n\n::: {.cell hash='2_Graphiques_cache/html/woolyrnq_8b7b43e46438c5ede0c5b993e4d0f45f'}\n\n```{.r .cell-code}\nautoplot(woolyrnq, y = \"tonnes\",\n\t\t main = \"Production trimestrielle de laine en Australie\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/woolyrnq-1.png){width=672}\n:::\n:::\n\n`gas` représente la production mensuelle de gaz en Australie entre janvier 1956 et août 1995\n\n::: {.cell hash='2_Graphiques_cache/html/gas_c090cf2ffc727bbecaec0d15c7de6dbe'}\n\n```{.r .cell-code}\nautoplot(gas, main = \"Production mensuelle de gaz en Australie\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/gas-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='2_Graphiques_cache/html/unnamed-chunk-3_3ac7cb5b3c748ca97bf17aab59e0b00e'}\n\n```{.r .cell-code}\n# Point atypique net pour la série gold à l'observation 770\nwhich.max(gold)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 770\n```\n:::\n\n```{.r .cell-code}\ngold[which.max(gold)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 593.7\n```\n:::\n\n```{.r .cell-code}\ndates = seq(from = ymd(\"1985-01-01\"), to = ymd(\"1989-03-31\"), by = \"day\")\nhors_wd = dates[lubridate::wday(dates,week_start = 1) %in% c(1:4,7)] # on ne prend pas les jours 6 et 7 (samedi et dimanche)\nlength(hors_wd) - length(gold) # on a bien le même nombre d'observations\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n\n```{.r .cell-code}\nhors_wd[which.max(gold)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"1987-12-14\"\n```\n:::\n:::\n\n:::\n\n::: callout-note\n## Exercice\nAnalyser les séries de `fpp3::aus_arrivals` (arrivées internationales trimestrielles en Australie) : évolution, tendance, saisonnalité et points atypiques (`autoplot()`, `gg_season()` et `gg_subseries()`).\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\n::: {.cell hash='2_Graphiques_cache/html/aus-arrivals_d365becb8faac8458278f8d0b9417201'}\n\n```{.r .cell-code}\naus_arrivals %>% autoplot(Arrivals)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/aus-arrivals-1.png){width=672}\n:::\n:::\n\nLe nombre d'arrivées augmentent avec le temps, sauf ceux en provenance du Japon après 1995.\nLes séries semblent saisonnières avec une saisonnalité qui dépend du niveau (sauf pour US) et on observe un changement de saisonnalité pour les arrivées en provenance du Japon\n\n::: {.cell hash='2_Graphiques_cache/html/aus-arrivals-season_4af25d1b49a8959e7dedd6c483cde811'}\n\n```{.r .cell-code}\naus_arrivals %>% gg_season(Arrivals)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/aus-arrivals-season-1.png){width=672}\n:::\n:::\n\nRemarque : le multivarié ne marche pas avec forecast.\n`forecast::ggseasonplot(arrivals)` donne une erreur.\n\nLa saisonnalité est différente entre chaque pays :\narrivées plus élevées aux T1 et T4 pour le Royaume-Uni.\nelles sont plus faibles au T1 pour la Nouvelle-Zélande et au plus haut au T3.\nPour le Japon : plus faibles aux T2 et T4 sur années récentes.\nPour les États-Unis le graphique n'est pas facile à lire\n\n::: {.cell hash='2_Graphiques_cache/html/aus-arrivals-subseries_f9e60714a551674f97fb1153e92c6d03'}\n\n```{.r .cell-code}\naus_arrivals %>% gg_subseries(Arrivals)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/aus-arrivals-subseries-1.png){width=672}\n:::\n:::\n\nPour le Royaume-Uni la hausse des entrées est surtout saisonnière (forte hausse aux T1 et T3).\nDepuis les États-Unis et la Nouvelle-Zélande la hausse semble la même sur tous les trimestres.\n\nPlusieurs points atypiques s'observent, par exemple :\n\n- 2000T3 pour les US (JO)  \n- 2001T3-T4 pour les US (11 septembre)\n:::\n\n::: callout-note\n## Exercice\nEn utilisant les différentes fonctions apprises pour tracer les graphiques (`autoplot()`, `ggseasonplot()` et `ggsubseriesplot()`, `gglagplot()` et `ggAcf()`) analyser la série `fma::hsales` (tendance, saisonnalité, cycle, points atypiques).\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\n::: {.cell hash='2_Graphiques_cache/html/hsales_0d34b753ec3c11417e9e0afb156dca61'}\n\n```{.r .cell-code}\nautoplot(hsales)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/hsales-1.png){width=672}\n:::\n:::\n\nPas de tendance, il semble il y avoir une saisonnalité et un cycle\n\n::: {.cell hash='2_Graphiques_cache/html/hsales-season_fb9a301d2df4789ddd12d0fab9648d78'}\n\n```{.r .cell-code}\nggseasonplot(hsales)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/hsales-season-1.png){width=672}\n:::\n:::\n\nLes ventes semblent plus faibles en janv-déc et plus élevées en mars\n\n::: {.cell hash='2_Graphiques_cache/html/hsales-subseries_267104c18d86333cb8ca1ee736d50e46'}\n\n```{.r .cell-code}\nggsubseriesplot(hsales)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/hsales-subseries-1.png){width=672}\n:::\n:::\n\nOn retrouve en moyenne les résultats précédents mais les variations des coefficients saisonniers laissent penser à un cycle\n\n::: {.cell hash='2_Graphiques_cache/html/hsales-lag_acfa5347d51d6b7a6035122ed3439838'}\n\n```{.r .cell-code}\ngglagplot(hsales)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/hsales-lag-1.png){width=672}\n:::\n:::\n\nForte corrélation avec les valeurs précédentes et les valeurs saisonnières\n\n::: {.cell hash='2_Graphiques_cache/html/hsales-acf_01c926cbff50e6fcf0b81ba25652e58e'}\n\n```{.r .cell-code}\nggAcf(hsales)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/hsales-acf-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggAcf(hsales, 12*7)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/hsales-acf-2.png){width=672}\n:::\n:::\n\nEn augmentant le nombre de lag on repère plus facilement les cycles longs (environ 8 ans).\n:::\n\n## Densité spectrale\n\nLe but de ces exercices est de calculer les densités spectrales des différentes composantes :\n\n-   tendance  \n-   cycle  \n-   saisonnalité  \n-   irrégulier\n\nAttention : par défaut la fonction `spectrum` enlève une tendance linéaire à la série !\nVoir l'aide associée à la fonction `?spectrum`.\n\n::: callout-note\n## Exercice\nCalculer le périodogramme et le spectre autorégressif d'une tendance.\n:::\n\n::: {.callout-caution collapse=\"true\"}\n## Indice\nIl faut utiliser les paramètres `spectrum(., detrend = FALSE, log = \"no\")`.\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\n::: {.cell hash='2_Graphiques_cache/html/spectre-tendance_39e281da3d8bdc70c9487988ec2ac66c'}\n\n```{.r .cell-code}\nt = ts(1:100, frequency = 12, start = 2000)\nspectrum(t, \n\t\t detrend = FALSE,\n\t\t method = \"pgram\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-tendance-1.png){width=672}\n:::\n\n```{.r .cell-code}\nspectrum(t, \n\t\t method = \"ar\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-tendance-2.png){width=672}\n:::\n:::\n\n:::\n\n::: callout-note\n## Exercice\nCalculer le périodogramme et le spectre autorégressif d'une série mensuelle saisonnière.\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\n::: {.cell hash='2_Graphiques_cache/html/spectre-saisonnalite_8d458144941f019753d2c49dca1000bb'}\n\n```{.r .cell-code}\ns = ts(0, frequency = 12, start = 2000, end = 2020)\ns[cycle(s) == 2] <- 1\nspectrum(s, \n\t\t detrend = FALSE,\n\t\t method = \"pgram\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-saisonnalite-1.png){width=672}\n:::\n\n```{.r .cell-code}\nspectrum(s, \n\t\t method = \"ar\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-saisonnalite-2.png){width=672}\n:::\n:::\n\n:::\n\n::: callout-note\n## Exercice\nCalculer le périodogramme et le spectre autorégressif d'une cycle de 36 mois.\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\n::: {.cell hash='2_Graphiques_cache/html/spectre-cycle_7b0346e1d55b267c9f0ceec9c0120ad9'}\n\n```{.r .cell-code}\nc = ts(cos(2*pi/36*(1:100)) + sin(2*pi/36*(1:100)), frequency = 12, start = 2000)\nspectrum(c, \n\t\t detrend = FALSE,\n\t\t method = \"pgram\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-cycle-1.png){width=672}\n:::\n\n```{.r .cell-code}\nspectrum(c, \n\t\t method = \"ar\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-cycle-2.png){width=672}\n:::\n:::\n\n:::\n\n::: callout-note\n## Exercice\nPourquoi a-t-on un spectre différent en simulant un cycle de cette façon ?\n\n::: {.cell hash='2_Graphiques_cache/html/spectre-cycle-saison_a2980e42724d8ceb71c0cdd281546124'}\n\n```{.r .cell-code}\nc = ts(0, frequency = 12, start = 2000, end = 2020)\nc[cycle(c) == 12][c(TRUE, FALSE, FALSE)] <- 1\nc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec\n2000   0   0   0   0   0   0   0   0   0   0   0   1\n2001   0   0   0   0   0   0   0   0   0   0   0   0\n2002   0   0   0   0   0   0   0   0   0   0   0   0\n2003   0   0   0   0   0   0   0   0   0   0   0   1\n2004   0   0   0   0   0   0   0   0   0   0   0   0\n2005   0   0   0   0   0   0   0   0   0   0   0   0\n2006   0   0   0   0   0   0   0   0   0   0   0   1\n2007   0   0   0   0   0   0   0   0   0   0   0   0\n2008   0   0   0   0   0   0   0   0   0   0   0   0\n2009   0   0   0   0   0   0   0   0   0   0   0   1\n2010   0   0   0   0   0   0   0   0   0   0   0   0\n2011   0   0   0   0   0   0   0   0   0   0   0   0\n2012   0   0   0   0   0   0   0   0   0   0   0   1\n2013   0   0   0   0   0   0   0   0   0   0   0   0\n2014   0   0   0   0   0   0   0   0   0   0   0   0\n2015   0   0   0   0   0   0   0   0   0   0   0   1\n2016   0   0   0   0   0   0   0   0   0   0   0   0\n2017   0   0   0   0   0   0   0   0   0   0   0   0\n2018   0   0   0   0   0   0   0   0   0   0   0   1\n2019   0   0   0   0   0   0   0   0   0   0   0   0\n2020   0                                            \n```\n:::\n\n```{.r .cell-code}\nspectrum(c, \n\t\t method = \"pgram\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-cycle-saison-1.png){width=672}\n:::\n:::\n\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\nCar la série construire reste saisonnière (même valeurs dans les mois autres que décembre) !\n:::\n\n::: callout-note\n## Exercice\nCalculer le périodogramme d'un bruit blanc (utiliser `rnorm()`).\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\n::: {.cell hash='2_Graphiques_cache/html/spectre-irregulier_d78044cbdd0ed640853e5e4b39b68589'}\n\n```{.r .cell-code}\nset.seed(1)\ni = ts(rnorm(100), frequency = 12, start = 2000)\nspectrum(i, \n\t\t detrend = FALSE,\n\t\t method = \"pgram\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-irregulier-1.png){width=672}\n:::\n\n```{.r .cell-code}\nspectrum(i, \n\t\t method = \"ar\", log = \"no\")\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/spectre-irregulier-2.png){width=672}\n:::\n:::\n\nQuestion supplémentaire : à quoi correspond la droite du graphique précédent ?\n\nCela correspond à $\\mathbb V[i]/frequence \\simeq$ 0,067.\n:::\n\n# Transformation des séries\n\nL'objectif des exercices qui suivent est d'étudier la transformation de Box-Cox \n$$\nf_\\lambda(x)=\\begin{cases}\n\\log(x)&\\text{ si }\\lambda=0\\\\\n\\frac{sign(x)|x|^\\lambda -1}{\n\\lambda\n}&\\text{ si }\\lambda\\ne0\n\\end{cases}\n$$\n\n::: callout-note\n## Exercice\n\nPour les séries suivantes, étudier s'il faut faire une transformation de Box-Cox et si oui trouver un $\\lambda$ satisfaisant et vérifier le résultat avec `forecast::BoxCox.lambda()` : `datasets::JohnsonJohnson`, `datasets::AirPassengers`, `datasets::co2`, `fma::usdeaths`, `expsmooth::usgdp`.\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\n\n::: {.cell hash='2_Graphiques_cache/html/jj_6093da104a8b31e0fce41e12336bc524'}\n\n```{.r .cell-code}\nautoplot(JohnsonJohnson)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/jj-1.png){width=672}\n:::\n:::\n\nIl semble y avoir une saisonnalité plus importante lorsque la série est élevée et la tendance semble exponentielle.\n\n::: {.cell hash='2_Graphiques_cache/html/jj-log_ee8a968adbc15401e9eefc9d390ec584'}\n\n```{.r .cell-code}\nautoplot(BoxCox(JohnsonJohnson, 0))\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/jj-log-1.png){width=672}\n:::\n:::\n\nLa transformation en log semble trop forte : la variabilité au début de la série est plus importante qu'en fin de série.\n\n::: {.cell hash='2_Graphiques_cache/html/jj-bc_244e3aa6f5a5420ec56dafb816cc91ed'}\n\n```{.r .cell-code}\n(autoplot(BoxCox(JohnsonJohnson, 0.5)) + autoplot(BoxCox(JohnsonJohnson, 0.3))) /\n\t(autoplot(BoxCox(JohnsonJohnson, 0.1)) + autoplot(BoxCox(JohnsonJohnson, 0.2)))\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/jj-bc-1.png){width=672}\n:::\n:::\n\nLa racine carrée n'est assez forte mais les autres transformations semblent donner de bons résultats. \nLa méthode Guerrero donne $\\lambda = 0,15$.\n\n::: {.cell hash='2_Graphiques_cache/html/unnamed-chunk-4_69515b310dd60cc48e910ebc5226c66c'}\n\n```{.r .cell-code}\nBoxCox.lambda(JohnsonJohnson)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1540752\n```\n:::\n:::\n\n::: {.cell hash='2_Graphiques_cache/html/AirPassengers_2c827247e6542de9293301d3354477e1'}\n\n```{.r .cell-code}\nautoplot(AirPassengers)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/AirPassengers-1.png){width=672}\n:::\n:::\n\nIl semble y avoir une saisonnalité plus importante lorsque la série est élevée .\n\n::: {.cell hash='2_Graphiques_cache/html/AirPassengers-bc_7b62e63aefb7eca62701d6e9d9872835'}\n\n```{.r .cell-code}\nautoplot(BoxCox(AirPassengers, 0))\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/AirPassengers-bc-1.png){width=672}\n:::\n\n```{.r .cell-code}\nBoxCox.lambda(AirPassengers)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.2947156\n```\n:::\n\n```{.r .cell-code}\nautoplot(BoxCox(AirPassengers, BoxCox.lambda(AirPassengers))) + autoplot(log(AirPassengers))\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/AirPassengers-bc-2.png){width=672}\n:::\n:::\n\nLa transformation en log semble suffisante.\nLa méthode Guerrero donne $\\lambda = -0,3$. \nLe graphique est proche de celui du passage au logarithme : la recommandation est de garder la transformation en logarithme, plus explicable.\n\n\n::: {.cell hash='2_Graphiques_cache/html/co2_cac250e06bb15b155a9da9bbdf6a414d'}\n\n```{.r .cell-code}\nautoplot(co2)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/co2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nBoxCox.lambda(co2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.03432107\n```\n:::\n\n```{.r .cell-code}\nautoplot(co2) + autoplot(log(co2))\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/co2-2.png){width=672}\n:::\n:::\n\nUne tendance linéaire mais la saisonnalité n'est pas proportionnelle au niveau\nAucune transformation n'est nécessaire.\nLa méthode Guerrero donne $\\lambda = 0,0$ (log) sans que cela change les résultats.\n\n```{rusdeaths-bc}\nautoplot(usdeaths)\nBoxCox.lambda(usdeaths)\nautoplot(usdeaths) + autoplot(BoxCox(usdeaths, 0))\n```\nPas de tendance : aucune transformation n'est nécessaire.\nLa méthode Guerrero donne $\\lambda = 0,0$ (log) sans que cela change les résultats.\n\n::: {.cell hash='2_Graphiques_cache/html/usgdp_5873dbbc72886357299a4d005419c1ca'}\n\n```{.r .cell-code}\nautoplot(usgdp)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/usgdp-1.png){width=672}\n:::\n:::\n\nOn observe une tendance exponentielle : il peut être utile de faire une transformation\n\n::: {.cell hash='2_Graphiques_cache/html/usgdp-log_65c0f2cf3e5e15e7709f9c5b459e85b7'}\n\n```{.r .cell-code}\nautoplot(BoxCox(usgdp, 0))\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/usgdp-log-1.png){width=672}\n:::\n:::\n\nLa transformation en log semble suffisante,  peut-être légèrement trop forte.\nLa méthode Guerrero donne $\\lambda = 0,36$.\n\n::: {.cell hash='2_Graphiques_cache/html/usgdp-bc_9c21c05eb374d39a9e0684094927ca0d'}\n\n```{.r .cell-code}\nBoxCox.lambda(usgdp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.366352\n```\n:::\n\n```{.r .cell-code}\nautoplot(BoxCox(usgdp, 0))  + \n    geom_smooth(method='lm', formula= y~x, size = 0.5) +\n\tautoplot(BoxCox(usgdp, BoxCox.lambda(usgdp)))  + \n    geom_smooth(method='lm', formula= y~x, size = 0.5)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/usgdp-bc-1.png){width=672}\n:::\n:::\n\n:::\n\n::: callout-note\n## Exercice\nPourquoi la transformation de Box-Cox n'est pas adaptée à la série `expsmooth::cangas` ?\n\n::: {.cell hash='2_Graphiques_cache/html/cangas_139d7df907f6875b7d0f93f160997285'}\n\n```{.r .cell-code}\nautoplot(cangas)\n```\n\n::: {.cell-output-display}\n![](2_Graphiques_files/figure-html/cangas-1.png){width=672}\n:::\n:::\n\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\nOn observe une tendance générale à la hausse et une saisonnalité.\nEn revanche cette saisonnalité n'est pas proportionnelle au niveau : entre 1960 et 1970 elle semble proportionnelle au niveau mais entre 1975 et 1990 le niveau de la série est globalement stable mais la variance augmente.\n\nLa transformation de Box-Cox n'est adaptée que lorsque la variabilité de la série est proportionnelle à son niveau.\n:::\n\nLes précédents exercices portaient uniquement les fonctions de `forecast`.\nPour appliquer la méthode Guerrero avec un objet `tsibble` on peut utiliser la fonction `features(., features = guerrero)` :\n\n\n::: {.cell hash='2_Graphiques_cache/html/feasts-ex_0ee5ad850a384cdbe1920cc260b0e210'}\n\n```{.r .cell-code}\naus_arrivals %>% \n\tfeatures(features = guerrero)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 2\n  Origin lambda_guerrero\n  <chr>            <dbl>\n1 Japan           0.254 \n2 NZ              0.332 \n3 UK             -0.0511\n4 US              0.190 \n```\n:::\n\n```{.r .cell-code}\naus_arrivals %>% \n\tfeatures(features = guerrero) %>% \n\tpull(lambda_guerrero)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  0.25392556  0.33202070 -0.05108145  0.19043694\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}